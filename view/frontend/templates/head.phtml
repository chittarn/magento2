<?php try { ?>
<script>
<?php
	$product = $block->getProduct();
	$cart = $block->getCart();
	$listing = $block->getListing();
	$transaction = $block->getTransaction();
	$events = $block->getEvents();
	$pluginVersion = $block->getVersion();
	$timeStamp = time() * 1000;
?>
(function(w,d){
    try {
        d = w.digitalData || {};
        w.digitalData = d;
        d.version = <?php echo json_encode($block->getMagentoVersion()); ?>;
        d.page = <?php echo json_encode($block->getPage()); ?>;
        d.user = <?php echo json_encode($block->getUser()); ?>;
	<?php if($product): ?>d.product = <?php echo json_encode($product) ?>;<?php endif; ?>
	<?php if($cart): ?>d.cart = <?php echo json_encode($cart); ?>;<?php endif; ?>
	<?php if($listing): ?>d.listing = <?php echo json_encode($listing) ?>;<?php endif; ?>
	<?php if ($transaction): ?>d.transaction = <?php echo json_encode($transaction) ?>;<?php endif; ?>
	<?php if($events): ?>d.events = <?php echo json_encode($events); ?>;<?php endif; ?>
	<?php if ($pluginVersion): ?>d.pluginVersion = <?php echo json_encode($pluginVersion); ?>;<?php endif; ?>
	<?php if($timeStamp): ?>d.generatedDate = <?php echo json_encode($timeStamp); ?>;<?php endif; ?>

	} catch (e) {}})(window);
	
<?php } catch (Exception $e) {
	$block->_logger->critical($e);
}?>
</script>
